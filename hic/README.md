# Hi-C

This directory contains some commands and scripts to analyze Hi-C data. The data generated by Hi-C tools are included in 'data/' directory of this repository which is used by the main source code. 

## Data

Hi-C matrix data is downloaded from [here](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE151553). We are using `GSE151553_A364_merged.hic` file.

## Juicer 

Juicer is a pipeline for processing Hi-C datasets. It consists of a set of tools. We are using the following tools:
- `Juicer Tools`: To extract data from .hic file, e.g. geting contact density matrix.
- `Juicebox`: To visualize Hi-C maps. 
- `Hiccups`: To find chromatin loops.

To know more, check out [Juicer Wiki](https://github.com/aidenlab/juicer/wiki).

### Juicer Tools

**Install**

Download Juicer Tools `.jar` from [here](https://github.com/aidenlab/juicer/wiki/Download)

**Use**

- Generate contact density matrix from `.hic` file.

```sh
java -jar juicer_tools.jar dump <options> <data> <generated_data>
java -jar juicer_tools.jar dump observed VC  data/GSE151553_A364_merged.hic VII VII BP 10000 vii.txt 
```

The file vii.txt will contain the observed matrix of chromosome VII with VC normalization at 10kb resolution. The .txt file has three columns. Example:

```
40000	40000	18284.73
0	    50000	944.62305
10000	50000	1104.2627
```

First and second defines position. Third defines contact density. 

Ref: 

- [Juicer Tools Quick Start](https://github.com/aidenlab/juicer/wiki/Juicer-Tools-Quick-Start)
- [Data Extraction - Juicer Wiki](https://github.com/aidenlab/juicer/wiki/Data-Extraction)

### Juicebox 

**Install**

Download Juicebox jar from [here](https://github.com/aidenlab/Juicebox/wiki/Download).

**Use**

- Launch Juicebox

```sh
java -Xms512m -Xmx2048m -jar Juicebox.jar
```

- Once you've successfully launched Juicebox, click File -> Open to load a new Hi-C dataset.

Ref: 

- [Juicebox Wiki](https://github.com/aidenlab/Juicebox/wiki)

### HiCCUPS

**Use**
 
HiCCUPS CPU version failed to run on my pc. Main Hiccups algorithm of Juicer tools require GPU. So, I used Google Colab to run this algorithm. The notebook can be found [here](https://colab.research.google.com/drive/1D4lRnORwSygnOBksHkx6PXHz0a5nHEer?usp=sharing). 

Ref:

- [HiCCUPS - Juicer Wiki](https://github.com/aidenlab/juicer/wiki/HiCCUPS)

## HiC Explorer

### Format Conversion

**Convert Format**

First, `hic` to `cool`

Not setting resolution will convert for every resolution. This will create a multiple cool(mcool) file.

```sh
hicConvertFormat --matrices data/GSE151553_A364_merged.hic --outFileName data/GSE151553_A364_merged.mcool --inputFormat hic --outputFormat cool
```

Or, create a cool file with single resolution. 

```sh
hicConvertFormat --matrices data/GSE151553_A364_merged.hic --outFileName data/GSE151553_A364_merged.cool --inputFormat hic --outputFormat cool --resolutions 500
```

### TADs
**Find TADs**

```sh
hicFindTADs -m data/GSE151553_A364_merged.mcool::/resolutions/500 --outPrefix data/generated_data/IX_res_500_min2000_max5000_step1000_thres0.05_delta0.01_fdr --chromosomes IX --minDepth 2000 --maxDepth 5000 --step 1000 --thresholdComparisons 0.05  --delta 0.01 --correctForMultipleTesting fdr -p 64
```

This will divide whole chromosome into regions(domains). So, there are no non-domain region.

**Plot TADs**

```sh
hicPlotTADs --tracks track.ini -o figures/ix_domains_hicexp.png --region chrIX:1-434000
```

**Data**
*TAD separation score* 
- Reaches a local minimum between TADs. 
- Informs about the degree of TAD separation:
  - Adjacent TADs with more of Hi-C contacts between them receive a larger score compared to TADs having fewer contacts. 



## FAN-C

### Plotting 

`vmin` and `vmax` set the amount of contact that is shown. 

### TAD

**Plot domain**

```sh
fancplot -o figures/chrix_180kb_280kb.png IX:180kb-280kb -p triangular data/GSE151553_A364_merged.juicer.hic@800 -m 50000 -vmin 0 -vmax 50
```
`-m`: Maximum distance from diagonal to show

#### Insulation Score
The insulation score adds up contacts in a sliding window along the Hi-C matrix diagonal.

![insulation score](figures/fanc_insulation_score.png)

Regions with low score are “insulating”, i.e. regions between domains. Regions with high scores are most likely found inside domains.
Boundary scores are mostly opposite of insulation score. Lower ins score have higher boundary score. 

**Find insulation Score**

```sh
fanc insulation data/GSE151553_A364_merged.juicer.hic@500 data/generated_data/chrix_100kb_400kb.insulation -r IX:100kb-400kb -o bed -w 1000 2000 5000 10000 25000
```

**Plot Insulation Score**

```sh
fancplot --width 6 -o figures/chrix_500b_tads_insulation_1k_2k_5k.png IX:100kb-400kb -p triangular data/GSE151553_A364_merged.juicer.hic@500 -m 50000 -vmin 0 -vmax 50 -p line data/generated_data/chrix_100kb_400kb.insulation_1kb.bed data/generated_data/chrix_100kb_400kb.insulation_2kb.bed data/generated_data/chrix_100kb_400kb.insulation_5kb.bed -l "1kb" "2kb" "5kb"
```

**Find Boundaries**

```sh
fanc boundaries data/generated_data/chrix_100kb_400kb.insulation_1kb.bed data/generated_data/chrix_100kb_400kb.insulation_1kb_boundaries
```

**Plot Boundaries**

```sh
fancplot --width 6 -o figures/chrix_500b_tads_insulation_boundaries_1k.png IX:100kb-400kb -p triangular data/GSE151553_A364_merged.juicer.hic@500 -m 50000 -vmin 0 -vmax 50 -p line data/generated_data/chrix_100kb_400kb.insulation_1kb.bed -l "1kb" -p bar data/generated_data/chrix_100kb_400kb.insulation_1kb_boundaries
```

[TAD Analysis - FAN-C](https://vaquerizaslab.github.io/fanc/fanc-executable/fanc-analyse-hic/domains.html)